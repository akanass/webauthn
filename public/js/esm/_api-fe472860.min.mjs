import{a as e}from"./tslib.es6-4ef6c5c0.min.mjs";import{O as r,S as t,m as s}from"./map-77c3ace7.min.mjs";var n="undefined"!=typeof window&&window,o="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,i="undefined"!=typeof global&&global,a=n||i||o;function u(e,r){return void 0===r&&(r=null),new y({method:"GET",url:e,headers:r})}function p(e,r,t){return new y({method:"POST",url:e,body:r,headers:t})}function c(e,r){return new y({method:"DELETE",url:e,headers:r})}function h(e,r,t){return new y({method:"PUT",url:e,body:r,headers:t})}function d(e,r,t){return new y({method:"PATCH",url:e,body:r,headers:t})}var l=s((function(e,r){return e.response}));function f(e,r){return l(new y({method:"GET",url:e,responseType:"json",headers:r}))}var y=function(r){function t(e){var t=r.call(this)||this,s={async:!0,createXHR:function(){return this.crossDomain?function(){if(a.XMLHttpRequest)return new a.XMLHttpRequest;if(a.XDomainRequest)return new a.XDomainRequest;throw new Error("CORS is not supported by your browser")}():function(){if(a.XMLHttpRequest)return new a.XMLHttpRequest;var e=void 0;try{for(var r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=0;t<3;t++)try{if(e=r[t],new a.ActiveXObject(e))break}catch(e){}return new a.ActiveXObject(e)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!0,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof e)s.url=e;else for(var n in e)e.hasOwnProperty(n)&&(s[n]=e[n]);return t.request=s,t}var s;return e(t,r),t.prototype._subscribe=function(e){return new b(e,this.request)},t.create=((s=function(e){return new t(e)}).get=u,s.post=p,s.delete=c,s.put=h,s.patch=d,s.getJSON=f,s),t}(r),b=function(r){function t(e,t){var s=r.call(this,e)||this;s.request=t,s.done=!1;var n=t.headers=t.headers||{};return t.crossDomain||s.getHeader(n,"X-Requested-With")||(n["X-Requested-With"]="XMLHttpRequest"),s.getHeader(n,"Content-Type")||a.FormData&&t.body instanceof a.FormData||void 0===t.body||(n["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),t.body=s.serializeBody(t.body,s.getHeader(t.headers,"Content-Type")),s.send(),s}return e(t,r),t.prototype.next=function(e){this.done=!0;var r,t=this,s=t.xhr,n=t.request,o=t.destination;try{r=new m(e,s,n)}catch(e){return o.error(e)}o.next(r)},t.prototype.send=function(){var e=this.request,r=this.request,t=r.user,s=r.method,n=r.url,o=r.async,i=r.password,a=r.headers,u=r.body;try{var p=this.xhr=e.createXHR();this.setupEvents(p,e),t?p.open(s,n,o,t,i):p.open(s,n,o),o&&(p.timeout=e.timeout,p.responseType=e.responseType),"withCredentials"in p&&(p.withCredentials=!!e.withCredentials),this.setHeaders(p,a),u?p.send(u):p.send()}catch(e){this.error(e)}},t.prototype.serializeBody=function(e,r){if(!e||"string"==typeof e)return e;if(a.FormData&&e instanceof a.FormData)return e;if(r){var t=r.indexOf(";");-1!==t&&(r=r.substring(0,t))}switch(r){case"application/x-www-form-urlencoded":return Object.keys(e).map((function(r){return encodeURIComponent(r)+"="+encodeURIComponent(e[r])})).join("&");case"application/json":return JSON.stringify(e);default:return e}},t.prototype.setHeaders=function(e,r){for(var t in r)r.hasOwnProperty(t)&&e.setRequestHeader(t,r[t])},t.prototype.getHeader=function(e,r){for(var t in e)if(t.toLowerCase()===r.toLowerCase())return e[t]},t.prototype.setupEvents=function(e,r){var t=r.progressSubscriber;function s(e){var r,t=s,n=t.subscriber,o=t.progressSubscriber,i=t.request;o&&o.error(e);try{r=new g(this,i)}catch(e){r=e}n.error(r)}if(e.ontimeout=s,s.request=r,s.subscriber=this,s.progressSubscriber=t,e.upload&&"withCredentials"in e){var n,o;if(t)n=function(e){n.progressSubscriber.next(e)},a.XDomainRequest?e.onprogress=n:e.upload.onprogress=n,n.progressSubscriber=t;o=function(e){var r,t=o,s=t.progressSubscriber,n=t.subscriber,i=t.request;s&&s.error(e);try{r=new w("ajax error",this,i)}catch(e){r=e}n.error(r)},e.onerror=o,o.request=r,o.subscriber=this,o.progressSubscriber=t}function i(e){}function u(e){var r=u,t=r.subscriber,s=r.progressSubscriber,n=r.request;if(4===this.readyState){var o=1223===this.status?204:this.status,i="text"===this.responseType?this.response||this.responseText:this.response;if(0===o&&(o=i?200:0),o<400)s&&s.complete(),t.next(e),t.complete();else{s&&s.error(e);var a=void 0;try{a=new w("ajax error "+o,this,n)}catch(e){a=e}t.error(a)}}}e.onreadystatechange=i,i.subscriber=this,i.progressSubscriber=t,i.request=r,e.onload=u,u.subscriber=this,u.progressSubscriber=t,u.request=r},t.prototype.unsubscribe=function(){var e=this.done,t=this.xhr;!e&&t&&4!==t.readyState&&"function"==typeof t.abort&&t.abort(),r.prototype.unsubscribe.call(this)},t}(t),m=function(){return function(e,r,t){this.originalEvent=e,this.xhr=r,this.request=t,this.status=r.status,this.responseType=r.responseType||t.responseType,this.response=T(this.responseType,r)}}(),w=function(){function e(e,r,t){return Error.call(this),this.message=e,this.name="AjaxError",this.xhr=r,this.request=t,this.status=r.status,this.responseType=r.responseType||t.responseType,this.response=T(this.responseType,r),this}return e.prototype=Object.create(Error.prototype),e}();function T(e,r){switch(e){case"json":return function(e){return"response"in e?e.responseType?e.response:JSON.parse(e.response||e.responseText||"null"):JSON.parse(e.responseText||"null")}(r);case"xml":return r.responseXML;case"text":default:return"response"in r?r.response:r.responseText}}var g=function(e,r){return w.call(this,"ajax timeout",e,r),this.name="AjaxTimeoutError",this},v=function(){return y.create}();class q{constructor(e){Object.assign(this,e)}get userId(){return this.id}get userName(){return this.username}get displayName(){return this.display_name}get skipAuthenticatorRegistration(){return this.skip_authenticator_registration}get lastAccessTime(){return this.last_access_time}}class x{constructor(){}static instance(){return x._instance instanceof x||(x._instance=new x),x._instance}login(e,r){return v({url:"/api/login",method:"POST",headers:{"Content-Type":"application/json"},body:{username:e,password:r}}).pipe(s((e=>new q(e.response))))}loggedIn(){return v({url:"/api/logged-in",method:"GET"}).pipe(s((e=>new q(e.response))))}logout(){return v({url:"/api/delete-session",method:"DELETE"}).pipe(s((e=>e.response)))}patchUser(e,r){return v({url:`/api/users/${e}`,method:"PATCH",headers:{"Content-Type":"application/json"},body:r}).pipe(s((e=>new q(e.response))))}patchSession(e){return v({url:"/api/set-session-data",method:"PATCH",headers:{"Content-Type":"application/json"},body:e}).pipe(s((e=>e.response)))}cleanSession(e){return v({url:"/api/clean-session-data",method:"PATCH",headers:{"Content-Type":"application/json"},body:e}).pipe(s((e=>e.response)))}}const S=x.instance();export{x as Api,S as api};
