import{a as e}from"./tslib.es6-4ef6c5c0.min.mjs";import{h as t,o as n,i as r,S as o,O as i,a as u,m as c}from"./map-77c3ace7.min.mjs";function s(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var a=s(),f=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function l(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var d=function(e){if(e&&"function"==typeof e[n])return c=e,function(e){var t=c[n]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(f(e))return u=e,function(e){for(var t=0,n=u.length;t<n&&!e.closed;t++)e.next(u[t]);e.complete()};if(l(e))return i=e,function(e){return i.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,t),e};if(e&&"function"==typeof e[a])return o=e,function(e){for(var t=o[a]();;){var n=void 0;try{n=t.next()}catch(t){return e.error(t),e}if(n.done){e.complete();break}if(e.next(n.value),e.closed)break}return"function"==typeof t.return&&e.add((function(){t.return&&t.return()})),e};var o,i,u,c,s=r(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+s+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},p=function(t){function n(e){var n=t.call(this)||this;return n.parent=e,n}return e(n,t),n.prototype._next=function(e){this.parent.notifyNext(e)},n.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},n.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},n}(o),h=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.notifyNext=function(e){this.destination.next(e)},n.prototype.notifyError=function(e){this.destination.error(e)},n.prototype.notifyComplete=function(){this.destination.complete()},n}(o);function y(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[n]}(e))return function(e,t){return new i((function(r){var o=new u;return o.add(t.schedule((function(){var i=e[n]();o.add(i.subscribe({next:function(e){o.add(t.schedule((function(){return r.next(e)})))},error:function(e){o.add(t.schedule((function(){return r.error(e)})))},complete:function(){o.add(t.schedule((function(){return r.complete()})))}}))}))),o}))}(e,t);if(l(e))return function(e,t){return new i((function(n){var r=new u;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if(f(e))return function(e,t){return new i((function(n){var r=new u,o=0;return r.add(t.schedule((function(){o!==e.length?(n.next(e[o++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}(e,t);if(function(e){return e&&"function"==typeof e[a]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new i((function(n){var r,o=new u;return o.add((function(){r&&"function"==typeof r.return&&r.return()})),o.add(t.schedule((function(){r=e[a](),o.add(t.schedule((function(){if(!n.closed){var e,t;try{var o=r.next();e=o.value,t=o.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}})))}))),o}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}function b(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(b((function(n,r){return(o=e(n,r),u?y(o,u):o instanceof i?o:new i(d(o))).pipe(c((function(e,o){return t(n,e,r,o)})));var o,u}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new m(e,n))})}var m=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new v(e,this.project,this.concurrent))},e}(),v=function(t){function n(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var o=t.call(this,e)||this;return o.project=n,o.concurrent=r,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return e(n,t),n.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},n.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t)},n.prototype._innerSub=function(e){var t=new p(this),n=this.destination;n.add(t);var r=function(e,t){if(!t.closed)return e instanceof i?e.subscribe(t):d(e)(t)}(e,t);r!==t&&n.add(r)},n.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},n.prototype.notifyNext=function(e){this.destination.next(e)},n.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},n}(h);const w=document.querySelector("#error-login-authenticator"),x=document.querySelector("#error-login-authenticator-message"),_=document.querySelector("#error-webauthn-message"),S=document.querySelector("#button-icon"),I=document.querySelector("#button-label"),T=document.querySelector("#start-enrollment"),g=document.querySelector("#stop-enrollment");let E,N;window.addEventListener("load",(()=>{j(),k(),q(),C()}));const j=()=>{w.style.display="none",x.style.display="none",x.innerText="",_.style.display="none"},k=()=>{S.innerText="fingerprint",I.innerText="Start Enrollment"},q=()=>{g.addEventListener("click",(()=>{j(),g.checked?(S.innerText="exit_to_app",I.innerText="Skip Enrollment"):k()}))},C=()=>{T.addEventListener("click",(()=>{j(),T.disabled=!0,g.disabled=!0,E&&E.unsubscribe(),N&&N.unsubscribe(),g.checked?import("./_api-5795789f.min.mjs").then((({api:e})=>{E=e.loggedIn().pipe(b((t=>e.patchUser(t.userId,{skip_authenticator_registration:!0}))),b((()=>e.clearSession({key:"previous_step"})))).subscribe((()=>{E.unsubscribe(),window.location.href="/end"}),(e=>O(e)))})):import("./_webauthn-dd6c3eb9.min.mjs").then((({webAuthn:e})=>{e.supported?import("./_api-5795789f.min.mjs").then((({api:e})=>{N=e.patchSession({key:"previous_step",value:"login_authenticator"}).subscribe((()=>{N.unsubscribe(),window.location.href="/webauthn/authenticator"}),(e=>O(e)))})):(w.style.display="flex",x.style.display="none",x.innerText="",_.style.display="inline")}))}))},O=e=>{if(401===e.status)window.location.href="/error";else{const n=[].concat(e.message).shift();t=n,w.style.display="flex",x.style.display="inline",x.innerText=t,_.style.display="none",setTimeout((()=>{T.disabled=!1,g.disabled=!1}),500)}var t};
